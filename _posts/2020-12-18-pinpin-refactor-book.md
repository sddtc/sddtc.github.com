---
title: "[读书笔记] 品品《重构》这本书嗷"
layout: post
categories: sddtc
date: "2020-12-18"
guid: urn:uuid:a93dc7db-0ac2-40c2-9980-af9d142cd8c3
tags:
  - java
---

书里首先介绍了重构这种行为朴素的优点：  

> 重构行为可以使责任的分配更为合理，使代码的维护更加轻松。 重构之后风格会迥异与过程化风格-后者也许是某些人习惯的风格。
  
接着又朴素的强调了测试的重要性，它是重构的前提。 因为测试可以帮助我们来方便的验证重构行为对功能没有产生不好的效果。
  
> 重构的节奏一般是测试，小修改，测试，小修改，测试，小修改..  

接着作者对重构进行了定义，~~太严谨了~~ 重构可以根据上下文的不同分为两种定义：  
* 名次形式： 对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。
* 动词形式： 使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构。

重构和对程序进行性能优化是两个独立的概念，有相似性和区别:
* 相似性：他们都只会改变其内部结构。 然而对软件可观察的外部行为只造成很小变化，或甚至不造成变化（性能优化使执行速度变快）
* 区别：
  * 重构的目的是使软件更容易被理解和修改。
  * 性能优化往往使代码较难理解，但为了得到所需的性能你不得不那么做。

当你使用重构技术开发软件时，你会把自己的时间分配给两种截然不同的行为：添加新功能，以及重构。 这就是所谓的 "两顶帽子" 比喻：  
当你带上了添加新功能的 🎩，那么你就不应该修改既有代码，只管添加新功能。通过测试    
当你带上了重构的🎩， 那么你就不应该再进行和新功能有关的开发工作，只管改进程序结构  

那句话又来了  
> 重构不是所谓的"银弹" -- 然而是一把"银钳子"

如果没有重构，程序的设计会逐渐腐败变质。 当人们只为短期目的或是在完全理解整体设计之前就贸然修改代码，程序将逐渐失去自己的结构。代码结构的流失是累积性的。          
这句话让我想起来看过的一本书，图解逻辑思维什么的。 大概意思是说很多人~~理工科的~~很容易陷入局部思考而忽略整体。想了想大部分人会为了重构而重构 -- 那么就是忽视了整体设计而专注于个别变量，方法，类。 那么这样我觉得也算不上保护了设计。      

> 我不是个伟大的程序员，我只是个有着一些优秀习惯的好程序员 - [Kent Beck](https://en.wikipedia.org/wiki/Kent_Beck)  

> 计算机科学是这样一门科学： 它相信所有问题都可以通过增加一个间接层来解决 - Dennis DeBruler

这样看来我确实不会对大多数重构都为程序引入了更多间接层而惊讶。 重构往往把大型对象拆成多个小型对象，把大型函数拆成多个小型函数。 然而那句话又来了，间接层是一把双刃剑。书中列举了它的若干价值：
* 允许逻辑共享
* 分开解释意图和实现
* 隔离变化
* 封装条件逻辑

在这本书的第三章作者描述了多达 22 种代码坏味道。 不得不说我打算看这本的初衷是我被一种坏味道的名字吸引了😂。 在这些每一个坏味道的子内容里，作者还给出了怎么做, 简直不要更贴心。  
当我看到第四章节的时候我停下来了。 第四章讲的是构筑测试体系。  

> 如果认真观察程序员把最多的时间耗在哪里，你会发现。 编写代码其实只是非常小的一部分。
> 有些时间是在决定下一步干什么
> 另一些时间花在设计上
> 最多的时间则是用来调试。

回想起来，竟然默默的点了点头。 修复错误通常比较快， 找出错误却是一场噩梦。  
一套测试就是一个强大的 bug 侦测器， 能够大大缩减查找 bug 所需要的时间。 然而说服别人编写测试并不容易。 不仅意味着写超多的额外代码，还需要学习怎么写测试程序。    

频繁进行测试是极限编程的重要一环。 极限编程者都是十分专注的测试者。  
作者遵循的测试风格是观察类该做的事情然后针对任何一项功能的任何一项可能失败的情况进行测试，而不是"测试所有的 public 函数"。 测试是一种风险驱动的行为，目的是希望找出现在或未来可能出现的错误。  
所以不会去测试那些仅读/写一个字段的访问函数，因为太简单而不大可能出错。  
测试的要诀是： 测试你最担心出错的部分。  
接着作者提到了一点： 测试代码和产品代码有个区别，你可以放心地复制编辑测试代码，处理多种组合情况。  
  
  

 
  



