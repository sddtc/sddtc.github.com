<!doctype html>
<html lang="zh">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Fastify æ¨¡å—åŒ–é¡¹ç›®å®æˆ˜(ä¸€)</title>
		<meta name="description" content="ä¸ªäººåšå®¢.">
		<link rel="icon" href="/sddtc.github.com/img/favicon.ico">
		<meta name="generator" content="Eleventy v3.1.2">
		
		
		<style>/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #082840;
	--text-color-link-active: #5f2b48;
	--text-color-link-visited: #17050F;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}

html {
	overflow-y: scroll;
}

body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img {
	max-width: 100%;
}

img[width][height] {
	height: auto;
}

img[src$=".svg"] {
	width: 100%;
	height: auto;
	max-width: none;
}

video,
iframe {
	width: 100%;
	height: auto;
}

iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}

p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}

a[href]:visited {
	color: var(--text-color-link-visited);
}

a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}

main :first-child {
	margin-top: 0;
}

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}

.links-nextprev>* {
	flex-grow: 1;
}

.links-nextprev-next {
	text-align: right;
}

table {
	width: 100%;
	border-collapse: collapse;
	/* Merges borders */
	margin-bottom: 1rem;
}

th,
td {
	padding: 12px;
	text-align: left;
	border-bottom: 1px solid #ddd;
}

th {
	background-color: var(--background-color);
	color: #333;
}

pre,
code {
	font-family: var(--font-family-monospace);
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375;
	/* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}

code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}

.home-link {
	flex-grow: 1;
	font-size: 1em;
	/* 16px /16 */
	font-weight: 700;
}

.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}

.nav-item {
	display: inline-block;
}

.nav-item a[href]:not(:hover) {
	text-decoration: none;
}

.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
	padding-left: 1.5rem;
}

.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}

.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	content: "" counter(start-from, decimal-leading-zero) ". ";
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}

.postlist-date,
.postlist-item:before {
	font-size: 0.8125em;
	/* 13px /16 */
	color: var(--color-gray-90);
}

.postlist-date {
	word-spacing: -0.5px;
}

.postlist-link {
	font-size: 1.1875em;
	/* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	padding-left: .25em;
	padding-right: .5em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}

.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	font-style: italic;
}

.postlist-item>.post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}

.post-metadata time {
	margin-right: 1em;
}

.content-tableau {
	background-color: #dedfd1;
}
body {
	max-width: 50em;
}

:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #EEEFE0;

	--text-color: #525B44;
	--text-color-link: #819A91;
	--text-color-link-active: #A7C1A8;
	--text-color-link-visited: #819A91;

	--syntax-tab-size: 2;
}

a {
	text-decoration: none;
}

/* Tags */
.post-tag {
	font-style: normal;
}

/* å…¶ä»–é¡µé¢æ ·å¼, ä¾‹å¦‚: å…³äºæˆ‘ */
blockquote {
	border-left: 3px solid #333333;
	background-color: #F2EFE7;
	padding: 9px 9px 9px 15px;
}

/* æ–‡ç« å†…éƒ¨æ ·å¼ */
.page-post {
	margin: 10px 0;
}

.page-post {
	font-size: 18px;
}

.page-post a {
	text-decoration: none;
	color: #8AA624;
	border-bottom: 1px solid #8AA624
}

/* å¼•ç”¨ */
.page-post blockquote {
	border-left: 3px solid #333333;
	background-color: #F2EFE7;
	padding: 9px 9px 9px 15px;
}

/* å•è¡Œä»£ç  */
.page-post code {
	font-size: 13px;
	background-color: #F2EFE7;
	word-break: break-all;
	padding: 3px 5px;
	margin: 0 4px;
	border-radius: 5px;
	color: #333333;
	transition: all 500ms ease;
	font-style: normal;
}
/**
 * prism.js tomorrow night eighties for JavaScript, CoffeeScript, CSS and HTML
 * Based on https://github.com/chriskempson/tomorrow-theme
 * @author Rose Pritchard
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #ccc;
	background: none;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;

}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #2d2d2d;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.block-comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #999;
}

.token.punctuation {
	color: #ccc;
}

.token.tag,
.token.attr-name,
.token.namespace,
.token.deleted {
	color: #e2777a;
}

.token.function-name {
	color: #6196cc;
}

.token.boolean,
.token.number,
.token.function {
	color: #f08d49;
}

.token.property,
.token.class-name,
.token.constant,
.token.symbol {
	color: #f8c555;
}

.token.selector,
.token.important,
.token.atrule,
.token.keyword,
.token.builtin {
	color: #cc99cd;
}

.token.string,
.token.char,
.token.attr-value,
.token.regex,
.token.variable {
	color: #7ec699;
}

.token.operator,
.token.entity,
.token.url {
	color: #67cdcc;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}

.token.inserted {
	color: green;
}</style>
		
	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/sddtc.github.com/" class="home-link">å¤§èœ•</a>
			<nav>
				<h2 class="visually-hidden">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/sddtc.github.com/">ä¸»é¡µ</a></li>
					<li class="nav-item"><a href="/sddtc.github.com/tags/">æ ‡ç­¾</a></li>
					<li class="nav-item"><a href="/sddtc.github.com/blog/">æ–‡ç« </a></li>
					<li class="nav-item"><a href="/sddtc.github.com/about/">å…³äºæˆ‘</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				

<h1>Fastify æ¨¡å—åŒ–é¡¹ç›®å®æˆ˜(ä¸€)</h1>

<ul class="post-metadata">
	<li><time datetime="2026-02-12">12 February 2026</time></li>
	æ ‡ç­¾:
	<li><a href="/sddtc.github.com/tags/fastify/" class="post-tag">Fastify</a>, </li>
	<li><a href="/sddtc.github.com/tags/typescript/" class="post-tag">Typescript</a>, </li>
	<li><a href="/sddtc.github.com/tags/esm/" class="post-tag">ESM</a></li>
</ul>

<div class="page-post">
<aside>
  <div class="content-tableau">
        <ul><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9-fastify-%E8%80%8C%E9%9D%9E-nestjs%2C-expressjs%2C-koa%3F">ä¸ºä»€ä¹ˆé€‰æ‹© Fastify è€Œé NestJS, ExpressJS, Koa?</a></li><li><a href="#%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA-fastify-%E9%A1%B9%E7%9B%AE%E4%B9%8B%E5%89%8D%E9%9C%80%E8%A6%81%E8%80%83%E8%99%91%E7%9A%84%E4%B8%89%E4%BB%B6%E4%BA%8B">å¼€å§‹æ­å»º Fastify é¡¹ç›®ä¹‹å‰éœ€è¦è€ƒè™‘çš„ä¸‰ä»¶äº‹</a><ul><li><a href="#%E9%80%89%E6%8B%A9js%E8%BF%98%E6%98%AFts%3F">é€‰æ‹©JSè¿˜æ˜¯TS?</a></li><li><a href="#%E9%80%89%E6%8B%A9common-js-%E8%BF%98%E6%98%AF-es-module%3F">é€‰æ‹©Common JS è¿˜æ˜¯ ES Module?</a></li><li><a href="#%E9%80%89%E6%8B%A9node%E5%8E%9F%E7%94%9F%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E8%BF%98%E6%98%AF%E5%85%B6%E5%AE%83%3F">é€‰æ‹©NodeåŸç”Ÿæµ‹è¯•æ¡†æ¶è¿˜æ˜¯å…¶å®ƒ?</a></li></ul></li><li><a href="#%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAfastify%E9%A1%B9%E7%9B%AE">å¼€å§‹æ­å»ºFastifyé¡¹ç›®</a></li></ul>
      </div>
</aside>
  <h2 id="%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9-fastify-%E8%80%8C%E9%9D%9E-nestjs%2C-expressjs%2C-koa%3F" tabindex="-1">ä¸ºä»€ä¹ˆé€‰æ‹© Fastify è€Œé NestJS, ExpressJS, Koa?</h2>
<p>æŒ‰ç…§æˆ‘çš„ä¸ªäººç»éªŒ, ä¹‹å‰ä½¿ç”¨ ExpressJS æ¥æ­å»ºé¡¹ç›®, é¡¹ç›®ç»“æ„åŸºæœ¬å¦‚ä¸‹æ‰€ç¤º:</p>
<pre class="language-txt" tabindex="0"><code class="hljs language-txt">src/
â””â”€â”€â”€â”€â”€ infrastructures/
    â”‚   â”œâ”€â”€ db.js
    â”‚   â””â”€â”€ server.js
    â”‚
    â”œâ”€â”€ middlewares/
    â”‚   â””â”€â”€ authMiddleware.js
    â”‚
    â”œâ”€â”€ routes/
    â”‚   â”œâ”€â”€ authRoutes.js
    â”‚   â””â”€â”€ messageRoutes.js
    â”‚
    â””â”€â”€ services/
        â”œâ”€â”€ messagesService.js
        â”œâ”€â”€ userService.js
        â””â”€â”€ authService.js</code></pre>
<p>è¿™æ¬¡åœ¨æ„æ€æ¨¡å—åŒ–é¡¹ç›®çš„æ—¶å€™, æƒ³å°è¯•ä¸€äº›æ–°ä¸œè¥¿, èƒ½å¤Ÿæ»¡è¶³æˆ‘çš„å°è£…æ€§é«˜çš„éœ€æ±‚, é¦–å…ˆå¯¹æ¯”äº† NestJS å’Œ ExpressJS</p>
<table>
<thead>
<tr>
<th>å¯¹æ¯”é¡¹</th>
<th><strong>NestJS</strong></th>
<th><strong>ExpressJS</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å®šä½</strong></td>
<td>è¿›é˜¶å‹å…¨æ ˆåç«¯æ¡†æ¶</td>
<td>è½»é‡çº§ Web æ¡†æ¶</td>
</tr>
<tr>
<td><strong>æ¶æ„é£æ ¼</strong></td>
<td>å¼ºåˆ¶ MVC + æ¨¡å—åŒ– + DIï¼ˆå— Angular å¯å‘ï¼‰</td>
<td>æ— æ¶æ„è§„èŒƒï¼Œè‡ªç”±åº¦é«˜</td>
</tr>
<tr>
<td><strong>å­¦ä¹ æˆæœ¬</strong></td>
<td>ğŸŸ  ä¸­ç­‰åé«˜ï¼ˆéœ€è¦ç†è§£è£…é¥°å™¨/ä¾èµ–æ³¨å…¥ï¼‰</td>
<td>ğŸŸ¢ ä½ï¼ˆAPI ç®€æ´æ˜“ç”¨ï¼‰</td>
</tr>
<tr>
<td><strong>TypeScript æ”¯æŒ</strong></td>
<td>åŸç”Ÿæ”¯æŒï¼Œå¼ºç±»å‹ä¼˜å…ˆ</td>
<td>éœ€è¦æ‰‹åŠ¨é…ç½® TS</td>
</tr>
<tr>
<td><strong>ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰</strong></td>
<td>å†…ç½®æ”¯æŒ</td>
<td>æ— ï¼ˆé€šå¸¸ç”¨å•ä¾‹/å…¨å±€æˆ–è‡ªå®šä¹‰ DIï¼‰</td>
</tr>
<tr>
<td><strong>è·¯ç”±å®šä¹‰</strong></td>
<td>æ³¨è§£å¼æ§åˆ¶</td>
<td>æ‰‹åŠ¨é…ç½®è·¯ç”±</td>
</tr>
<tr>
<td><strong>æ‰©å±•æ€§</strong></td>
<td>â­â­â­â­</td>
<td>â­â­</td>
</tr>
<tr>
<td><strong>ç”Ÿæ€å’Œæ’ä»¶</strong></td>
<td>æ¨¡å—åŒ–ï¼ˆAuthã€Cacheã€Swaggerã€GraphQLã€Jobsï¼‰</td>
<td>éœ€è¦è‡ªè¡Œç»„åˆä¸­é—´ä»¶</td>
</tr>
<tr>
<td><strong>é€‚åˆåœºæ™¯</strong></td>
<td>ä¼ä¸šçº§å¤æ‚ä¸šåŠ¡ã€å¤§å›¢é˜Ÿåˆä½œ</td>
<td>å°é¡¹ç›®ã€å¿«é€ŸåŸå‹ã€çµæ´»ä¸šåŠ¡æµç¨‹</td>
</tr>
<tr>
<td><strong>æ€§èƒ½</strong></td>
<td>æ¥è¿‘ Express</td>
<td>åŸºäº Express / Fastifyï¼Œæ€§èƒ½ä¼˜ç§€</td>
</tr>
<tr>
<td><strong>ç¤¾åŒº &amp; æ–‡æ¡£</strong></td>
<td>æˆç†Ÿæ´»è·ƒ</td>
<td>ç»å…¸ç¨³å®š</td>
</tr>
</tbody>
</table>
<p>åœ¨è¿™ä¹‹ååˆäº†è§£äº† Fastify å’Œ Koa æ¡†æ¶:<br>
<strong>Fastify</strong></p>
<ul>
<li>æ€§èƒ½æ¯” Express æ›´é«˜</li>
<li>æ’ä»¶æœºåˆ¶</li>
<li>åŸç”Ÿæ”¯æŒè¶…å¿« JSON åºåˆ—åŒ–</li>
<li>é€‚åˆé«˜æ€§èƒ½ API æœåŠ¡</li>
<li>å­¦ä¹ æˆæœ¬ç•¥é«˜äº Express</li>
</ul>
<p><strong>Koa</strong></p>
<ul>
<li>ç”± Express æ ¸å¿ƒå›¢é˜Ÿæ‰“é€ </li>
<li>Promise + async/await åŸç”Ÿæ”¯æŒ</li>
<li>æ›´ç°ä»£ã€æ›´è½»é‡</li>
<li>ä¸­é—´ä»¶é‡‡ç”¨æ–°ç‰ˆæ´‹è‘±æ¨¡å‹</li>
</ul>
<p>ç„¶è€Œ Fastify çš„é«˜æ€§èƒ½ä»¥åŠæ’ä»¶æœºåˆ¶å¸å¼•äº†æˆ‘, äºæ˜¯æˆ‘æ‰“ç®—åŸºäº Fastify å¼€å§‹æ­å»ºé¡¹ç›®</p>
<h2 id="%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA-fastify-%E9%A1%B9%E7%9B%AE%E4%B9%8B%E5%89%8D%E9%9C%80%E8%A6%81%E8%80%83%E8%99%91%E7%9A%84%E4%B8%89%E4%BB%B6%E4%BA%8B" tabindex="-1">å¼€å§‹æ­å»º Fastify é¡¹ç›®ä¹‹å‰éœ€è¦è€ƒè™‘çš„ä¸‰ä»¶äº‹</h2>
<h3 id="%E9%80%89%E6%8B%A9js%E8%BF%98%E6%98%AFts%3F" tabindex="-1">é€‰æ‹©JSè¿˜æ˜¯TS?</h3>
<table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>JS</th>
<th>TS</th>
</tr>
</thead>
<tbody>
<tr>
<td>å­¦ä¹ æˆæœ¬</td>
<td>ä½</td>
<td>ä¸­</td>
</tr>
<tr>
<td>å¼€å‘é€Ÿåº¦ï¼ˆçŸ­æœŸï¼‰</td>
<td>å¿«</td>
<td>ç¨æ…¢</td>
</tr>
<tr>
<td>ç»´æŠ¤æˆæœ¬ï¼ˆé•¿æœŸï¼‰</td>
<td>é«˜</td>
<td>ä½</td>
</tr>
<tr>
<td>é‡æ„å®‰å…¨æ€§</td>
<td>ä½</td>
<td>é«˜</td>
</tr>
<tr>
<td>æ¨¡å—æ‰©å±•èƒ½åŠ›</td>
<td>ä¸­</td>
<td>é«˜</td>
</tr>
<tr>
<td>å·¥ç¨‹åŒ–èƒ½åŠ›</td>
<td>ä¸­</td>
<td>æé«˜</td>
</tr>
<tr>
<td>æ¶æ„æ¼”è¿›èƒ½åŠ›</td>
<td>å¼±</td>
<td>å¼º</td>
</tr>
<tr>
<td>æ¨¡æ¿å¤ç”¨ä»·å€¼</td>
<td>ä½</td>
<td>é«˜</td>
</tr>
<tr>
<td>é¡¹ç›®è§„æ¨¡é€‚é…</td>
<td>å°é¡¹ç›®</td>
<td>ä¸­å¤§å‹é¡¹ç›®</td>
</tr>
<tr>
<td>æŠ€æœ¯èµ„äº§ä»·å€¼</td>
<td>ä½</td>
<td>é«˜</td>
</tr>
</tbody>
</table>
<p>å¯¹äºå¤ç”¨ä»·å€¼æ¥è¯´, é€‰æ‹©TSæ˜¯å¿…é¡»çš„</p>
<h3 id="%E9%80%89%E6%8B%A9common-js-%E8%BF%98%E6%98%AF-es-module%3F" tabindex="-1">é€‰æ‹©Common JS è¿˜æ˜¯ ES Module?</h3>
<p>æˆ‘ä»¬éƒ½çŸ¥é“JSæœ‰ä¸¤ç§æ¨¡å—ç³»ç»Ÿ</p>
<blockquote>
<p>ES Modules (ESM) æ˜¯ ECMAScript æ ‡å‡†åŒ–çš„ç°ä»£ JavaScript æ¨¡å—ç³»ç»Ÿï¼Œä½¿ç”¨ import/exportï¼Œæ”¯æŒé™æ€åˆ†æã€å¼‚æ­¥åŠ è½½å’Œå•ä¾‹æ¨¡å¼ï¼Œé€‚ç”¨äºæµè§ˆå™¨å’Œæ–°ç‰ˆ Node.jsã€‚CommonJS (CJS) æ˜¯ Node.js ä¼ ç»Ÿçš„é»˜è®¤ç³»ç»Ÿï¼Œä½¿ç”¨ require/module.exportsï¼ŒåŒæ­¥åŠ è½½æ¨¡å—ï¼Œä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯ã€‚</p>
</blockquote>
<p>æ‰€ä»¥å®ƒä»¬ä¹‹é—´çš„æœ¬è´¨åŒºåˆ«æ˜¯åº•å±‚æœºåˆ¶çš„å·®å¼‚:<br>
CSJæ˜¯è¿è¡Œæ—¶åŠ è½½</p>
<pre class="language-txt" tabindex="0"><code class="hljs language-txt">require() æ˜¯å‡½æ•°
â†’ è¿è¡Œåˆ°è¿™è¡Œæ‰åŠ è½½
â†’ åŠ¨æ€åŠ è½½
â†’ æ— æ³•é™æ€åˆ†æä¾èµ–å…³ç³»</code></pre>
<p>è€ŒESJï¼ˆç¼–è¯‘æœŸé™æ€åˆ†æï¼‰</p>
<pre class="language-txt" tabindex="0"><code class="hljs language-txt">import æ˜¯è¯­æ³•
â†’ ç¼–è¯‘æœŸåˆ†æä¾èµ–
â†’ æ„å»ºä¾èµ–å›¾
â†’ æ”¯æŒ Tree-shaking
â†’ æ”¯æŒæ¨¡å—ä¼˜åŒ–</code></pre>
<p>åœ¨è¯­æ³•å±‚é¢:<br>
CommonJS:</p>
<pre class="language-js" tabindex="0"><code class="hljs language-js"><span class="token comment">// å¯¼å…¥</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token comment">// å¯¼å‡º</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>ES Module:</p>
<pre class="language-js" tabindex="0"><code class="hljs language-js"><span class="token comment">// å¯¼å…¥</span>
<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span>

<span class="token comment">// å¯¼å‡º</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<p>äºæ˜¯æˆ‘é€‰æ‹©äº†ESMæ¥æ­å»ºé¡¹ç›®æ¨¡å—, è¿™ä¹Ÿæ˜¯å½“ä¸‹çš„å·¥ç¨‹è¶‹åŠ¿</p>
<h3 id="%E9%80%89%E6%8B%A9node%E5%8E%9F%E7%94%9F%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E8%BF%98%E6%98%AF%E5%85%B6%E5%AE%83%3F" tabindex="-1">é€‰æ‹©NodeåŸç”Ÿæµ‹è¯•æ¡†æ¶è¿˜æ˜¯å…¶å®ƒ?</h3>
<p>è°ˆåˆ°JSæµ‹è¯•æ¡†æ¶, ç«‹é©¬èƒ½æƒ³åˆ° Jest, Vitest, Mocha, Chai, åœ¨JSç”Ÿæ€é‡Œ, ä¸€èˆ¬åœ¨å‰ç«¯ä¼šæµ‹è¯•ç»„ä»¶æ¸²æŸ“, åœ¨åç«¯æ˜¯ä¸€äº›ç®€å•çš„æ–­è¨€, ä¾‹å¦‚æµ‹è¯• Rest API çš„è¯·æ±‚, å·¥å…·åº“çš„å•å…ƒæµ‹è¯•ç­‰, æ¥è§¦äº† Fastify æˆ‘äº†è§£åˆ°äº† Node åŸç”Ÿæµ‹è¯•æ–¹æ³•.</p>
<table>
<thead>
<tr>
<th>èƒ½åŠ›</th>
<th>Jest</th>
<th>Vitest</th>
<th>node:test</th>
</tr>
</thead>
<tbody>
<tr>
<td>Runner</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>Mock</td>
<td>âœ… å¼º</td>
<td>âœ… å¼º</td>
<td>âš ï¸ åŸºç¡€</td>
</tr>
<tr>
<td>è¦†ç›–ç‡</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âš ï¸ å¤–æ¥</td>
</tr>
<tr>
<td>Watch</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âŒ</td>
</tr>
<tr>
<td>å¿«ç…§æµ‹è¯•</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âŒ</td>
</tr>
<tr>
<td>å¹¶å‘æ‰§è¡Œ</td>
<td>âš ï¸</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>ESM æ”¯æŒ</td>
<td>âš ï¸ é…ç½®å¤æ‚</td>
<td>âœ… åŸç”Ÿ</td>
<td>âœ… åŸç”Ÿ</td>
</tr>
<tr>
<td>TS æ”¯æŒ</td>
<td>âš ï¸ ä¾èµ– ts-jest</td>
<td>âœ… åŸç”Ÿ</td>
<td>âš ï¸ æ‰‹åŠ¨</td>
</tr>
<tr>
<td>ç”Ÿæ€æ’ä»¶</td>
<td>âœ… éå¸¸æˆç†Ÿ</td>
<td>ğŸŸ¡ æˆé•¿ä¸­</td>
<td>âŒ å‡ ä¹æ— </td>
</tr>
</tbody>
</table>
<p>ä¸¾å‡ ä¸ªç®€å•çš„ä¾‹å­å§, åœ¨ vitest é‡Œ:<br>
å‰ç«¯çš„æµ‹è¯•:</p>
<pre class="language-js" tabindex="0"><code class="hljs language-js"><span class="token comment">// ä½¿ç”¨ vitest çš„æ–¹æ³•</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> vi <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vitest"</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fireEvent<span class="token punctuation">,</span> render<span class="token punctuation">,</span> screen<span class="token punctuation">,</span> waitFor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@testing-library/react"</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">"../../src/components/App"</span>

<span class="token comment">// é€šè¿‡ vi.hoisted æ¥ mock æ–¹æ³•</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> mockGetNotes<span class="token punctuation">,</span> mockDeleteNote<span class="token punctuation">,</span> mockPutNote <span class="token punctuation">}</span> <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">hoisted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">mockGetNotes</span><span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">mockDeleteNote</span><span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">mockPutNote</span><span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ä½¿ç”¨ä¸Šé¢çš„mockæ–¹æ³•æ¥æ›¿æ¢åç«¯çš„å…·ä½“æ–¹æ³•</span>
vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'../../src/services/notesService'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">getNotes</span><span class="token operator">:</span> mockGetNotes<span class="token punctuation">,</span> <span class="token literal-property property">deleteNote</span><span class="token operator">:</span> mockDeleteNote<span class="token punctuation">,</span> <span class="token literal-property property">putNote</span><span class="token operator">:</span> mockPutNote <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"render app"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should show notes successfully"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">//mockå®ç°</span>
    mockGetNotes<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"fake note1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"fake note1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"fake note1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should delete note successfully when click delete note button"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    mockGetNotes<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"fake note1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"fake note1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> deleteNoteBtn <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByTestId</span><span class="token punctuation">(</span><span class="token string">"delete-note"</span><span class="token punctuation">)</span>
    fireEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>deleteNoteBtn<span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>mockDeleteNote<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>åç«¯çš„æµ‹è¯•ä¾‹å­:</p>
<pre class="language-js" tabindex="0"><code class="hljs language-js"><span class="token comment">// vitest çš„æ–¹æ³•</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> beforeEach<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> vi<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vitest"</span>
<span class="token keyword">import</span> notesService <span class="token keyword">from</span> <span class="token string">"../../src/services/notesService"</span>

<span class="token keyword">const</span> mockSelect <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mockInsert <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mockDelete <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mockEq <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// mock åŸºç¡€è®¾æ–½(DB)çš„ client çš„ç›¸å…³æ–¹æ³•</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> supabaseMockClient <span class="token punctuation">}</span> <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">hoisted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">supabaseMockClient</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">from</span><span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">select</span><span class="token operator">:</span> mockSelect<span class="token punctuation">,</span>
        <span class="token literal-property property">insert</span><span class="token operator">:</span> mockInsert<span class="token punctuation">,</span>
        <span class="token keyword">delete</span><span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">eq</span><span class="token operator">:</span> mockEq
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// æ›¿æ¢å¤–éƒ¨ä¾èµ–çš„å…·ä½“æ–¹æ³•ä¸ºmockæ–¹æ³•</span>
vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'@supabase/supabase-js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">createClient</span><span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> supabaseMockClient<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"notes service layer tests"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    vi<span class="token punctuation">.</span><span class="token function">clearAllMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should return notes array"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    mockSelect<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">note</span><span class="token operator">:</span> <span class="token string">'note1'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">note</span><span class="token operator">:</span> <span class="token string">'note2'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> notesService<span class="token punctuation">.</span><span class="token function">getNotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>supabaseMockClient<span class="token punctuation">.</span>from<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'notes-online'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>supabaseMockClient<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'note'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'note1'</span><span class="token punctuation">,</span> <span class="token string">'note2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should return empty array when return error"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    mockSelect<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"some errors"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> notesService<span class="token punctuation">.</span><span class="token function">getNotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should save note successfully"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    mockInsert<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">await</span> notesService<span class="token punctuation">.</span><span class="token function">putNote</span><span class="token punctuation">(</span><span class="token string">"new fake note"</span><span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>supabaseMockClient<span class="token punctuation">.</span>from<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'notes-online'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>supabaseMockClient<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>insert<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">note</span><span class="token operator">:</span> <span class="token string">"new fake note"</span><span class="token punctuation">,</span> <span class="token literal-property property">creator</span><span class="token operator">:</span> <span class="token string">"anonymous"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">returning</span><span class="token operator">:</span> <span class="token string">'minimal'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should delete note successfully"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    mockDelete<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    mockEq<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">await</span> notesService<span class="token punctuation">.</span><span class="token function">deleteNote</span><span class="token punctuation">(</span><span class="token string">"fake note"</span><span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>supabaseMockClient<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>eq<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'note'</span><span class="token punctuation">,</span> <span class="token string">'fake note'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>è€Œæœ€è¿‘ä½¿ç”¨äº† node:test, ä¾‹å¦‚:</p>
<pre class="language-ts" tabindex="0"><code class="hljs language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'node:test'</span>
<span class="token keyword">import</span> assert <span class="token keyword">from</span> <span class="token string">'node:assert'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> build<span class="token punctuation">,</span> expectValidationError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../../helper.js'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Security api'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'POST /api/v1/auth/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Transaction should rollback on error'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">build</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>

      <span class="token keyword">const</span> <span class="token punctuation">{</span> mock<span class="token operator">:</span> mockCompare <span class="token punctuation">}</span> <span class="token operator">=</span> t<span class="token punctuation">.</span>mock<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>passwordManager<span class="token punctuation">,</span> <span class="token string">'compare'</span><span class="token punctuation">)</span>
      mockCompare<span class="token punctuation">.</span><span class="token function">mockImplementationOnce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> hash<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Kaboom!'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token keyword">const</span> <span class="token punctuation">{</span> mock<span class="token operator">:</span> mockLogError <span class="token punctuation">}</span> <span class="token operator">=</span> t<span class="token punctuation">.</span>mock<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">)</span>

      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token string">'/api/v1/auth/login'</span><span class="token punctuation">,</span>
        payload<span class="token operator">:</span> <span class="token punctuation">{</span>
          email<span class="token operator">:</span> <span class="token string">'basic@example.com'</span><span class="token punctuation">,</span>
          password<span class="token operator">:</span> <span class="token string">'Password123$'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      assert<span class="token punctuation">.</span><span class="token function">strictEqual</span><span class="token punctuation">(</span>mockCompare<span class="token punctuation">.</span><span class="token function">callCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

      <span class="token keyword">const</span> arg <span class="token operator">=</span> mockLogError<span class="token punctuation">.</span>calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token builtin">unknown</span> <span class="token keyword">as</span> <span class="token punctuation">{</span>
        err<span class="token operator">:</span> Error<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      assert<span class="token punctuation">.</span><span class="token function">strictEqual</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
      assert<span class="token punctuation">.</span><span class="token function">deepStrictEqual</span><span class="token punctuation">(</span>arg<span class="token punctuation">.</span>err<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token string">'Kaboom!'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>ä½¿ç”¨ä¹‹åä¹Ÿå¾ˆé¡ºæ‰‹, ä¸€ä¸ªæ˜¯æ²¡æœ‰å¤–éƒ¨ä¾èµ–, å¦å¤–ä¹Ÿèƒ½æ»¡è¶³éœ€æ±‚, æ‰€ä»¥ç›®å‰æˆ‘ä¹Ÿå¹¶æœªä½¿ç”¨å…¶å®ƒæµ‹è¯•æ¡†æ¶.</p>
<h2 id="%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAfastify%E9%A1%B9%E7%9B%AE" tabindex="-1">å¼€å§‹æ­å»ºFastifyé¡¹ç›®</h2>
<p>TBC</p>

</div>
<ul class="links-nextprev"><li class="links-nextprev-prev">â† Previous<br> <a href="/sddtc.github.com/blog/2026-01-07-something-about-javassist/">Something About Javassist</a></li>
</ul>

			</heading-anchors>
		</main>

		<footer>
			<p>Copyright Â© <span id="copyright-year"></span></p>
		</footer>

		

    
		

		<!-- google analysis start -->
		
		<!-- google analysis start -->

		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-KVM27VFBYL"></script>
		
		<!-- Global site tag (gtag.js) - Google Analytics end -->

		<!-- This page `/blog/2026-02-12-fastify-modules-tutorials-1/` was built on 2026-02-17T05:40:04.952Z -->
		<script type="module" src="/sddtc.github.com/dist/UgeZB_NEmy.js"></script>
	</body>
</html>
